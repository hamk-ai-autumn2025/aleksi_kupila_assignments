{% extends "layout.html" %}
{% block title %}Cybersecurity adversary simulator{% endblock %}

{% block content %}
    <h2>AI Adversary Simulator â€” PoC</h2>
    <div class="mb-3" id="requestArea">
        <form method="post" action="/suggest">
            <div class="mb-3">
                <label class="form-label">Instruction (natural language):</label><br/>
                <textarea class="form-control" id="user_request" name="instruction"></textarea><br/>
            </div>
        <button type="submit" class="btn btn-primary">Get Command Suggestion</button>
        </form>
    </div>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}

{% if suggestion %}
  <div id="suggestionArea" class="mb-3">
    <h3>AI Suggested Commands</h3>
    <form method="post" action="/run">
      {% for cmd in suggestion %}
        <div class="form-check">
          <input class="form-check-input" type="radio" name="approved_cmd" id="cmd{{ loop.index }}" value="{{ cmd.command }}" {% if loop.first %}checked{% endif %}>
          <label class="form-check-label" for="cmd{{ loop.index }}">
            <strong>Tool:</strong> {{ cmd.tool }} &nbsp; <strong>Command:</strong> <code>{{ cmd.command }}</code>
          </label>
        </div>
      {% endfor %}
      <br/>
      <button type="submit" class="btn btn-success">Run in Docker (executor)</button>
    </form>
  </div>
{% endif %}

{% if approved_command %}
  <div id="outputArea" style="display:none">
    <h3>Raw Output</h3>
    <pre id="raw_out"></pre>
    <h3>AI Analysis</h3>
    <pre id="analysis"></pre>
  </div>
{% endif %}
{% endblock %}