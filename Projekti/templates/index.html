{% extends "layout.html" %}
{% block title %}Cybersecurity adversary simulator{% endblock %}

{% block content %}
    <h2>AI Adversary Simulator â€” PoC</h2>
    <div class="mb-3" id="requestArea">
        <form method="post" action="/suggest">
            <div class="mb-3">
                <label class="form-label">Instruction (natural language):</label><br/>
                <textarea class="form-control" id="user_request" name="instruction"></textarea><br/>
            </div>
        <button type="submit" class="btn btn-primary">Get Command Suggestion</button>
        </form>
    </div>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}

{% if suggestion %}
  <div id="suggestionArea" class="mb-3">
    <h3>AI Suggested Commands</h3>
    <form method="post" action="/run">
      {% for cmd in suggestion %}
        <div class="form-check">
          <input class="form-check-input" type="radio" name="approved_cmd" id="cmd{{ loop.index }}" value="{{ cmd.command }}" {% if loop.first %}checked{% endif %}>
          <label class="form-check-label" for="cmd{{ loop.index }}">
            <strong>Tool:</strong> {{ cmd.tool }} &nbsp; <strong>Command:</strong> <code>{{ cmd.command }}</code>
          </label>
        </div>
      {% endfor %}
      <br/>
      <button type="submit" class="btn btn-success">Run in Docker (executor)</button>
    </form>
  </div>
{% endif %}

{% if command_output %}
<form method="post" action="/save">
  <div id="outputArea" class="mb-3">
    <h3>Raw Output</h3>
    <div class="mb-3">
      <input type="hidden" name="command" value="{{ command|escape }}">
      <textarea class="form-control" id="raw_out" name="command_output" rows="6" readonly>{{ command_output }}</textarea>
    </div>

    <h3>AI Analysis</h3>
    <div class="mb-3">
      <textarea class="form-control" id="analysis" name="ai_analysis" rows="6" readonly>{{ ai_analysis }}</textarea>
    </div>
  </div>

  <button type="submit" class="btn btn-success">Save output (JSON)?</button>
</form>
{% endif %}


{% endblock %}